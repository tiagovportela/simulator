<!DOCTYPE html>
<html>
  
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/addons/p5.dom.min.js"></script>
    <script src="{{ url_for('static', filename='Chart.js') }}"></script>
    <script src="{{ url_for('static', filename='utils.js') }}"></script>

    <!-- <script type="text/javascript" src="particle.js"></script>
    <script type="text/javascript" src="particlesystem.js"></script>
    <script type="text/javascript" src="sketch.js"></script> -->

    <script type="text/javascript" src="{{ url_for('static', filename='particle.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='particlesystem.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='sketch.js') }}"></script>

    <meta charset="utf-8" />
    <style>
      canvas {
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
      }
    </style>
</head>

<body>
  <h1>Infectious Disease Simulator</h1>
  <!-- <div style="width: 100%; display: table;">
    <div style="display: table-row">
		<div style="width: 600px; display: table-cell;"> 
			<div id="sketch-holder">
    
			</div> 
		</div>
		<div style="display: table-cell width: 638; height: 358;">  
			<canvas id="canvas"></canvas>
		</div>
    </div>
</div> -->
<div id="sketch-holder">
</div> 

<div style="width:50%; height: 50%;">
	<canvas id="canvas"></canvas>
</div>
<button onclick="removeData()">Reset Plot</button>


 
  
	<script>
	
	let data_points_counter = 0;

    let data_points = get_data();
    

    setInterval(addData, 60)

    
    
    var config = {
			type: 'line',
			data: {
				labels: data_points[0],
				datasets: [{
					label: 'Infected',
					fill: false,
					borderColor: window.chartColors.red,
					backgroundColor: window.chartColors.red,
					data: [data_points[1]],
				}, {
					label: 'Susceptable',
					fill: false,
					borderColor: window.chartColors.blue,
					backgroundColor: window.chartColors.blue,
					data: [data_points[2]],
				}, {
					label: 'Removed',
					fill: false,
					borderColor: window.chartColors.green,
					backgroundColor: window.chartColors.green,
					data: [data_points[3]],
				}]
			},
			options: {
				responsive: true,
				title: {
					display: true,
					text: 'Population Size'
				},
				tooltips: {
					mode: 'index',
					intersect: false,
				},
				hover: {
					mode: 'nearest',
					intersect: true
				},
				scales: {
					x: {
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Time'
						}
					},
					y: {
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Value'
						}
					}
				}
			}
		};

	var empty_plot_data = config

	function drawChart(objChart,data){
			if(window.myLine!=null){
				window.myLine .destroy();
			}
		// Get the context of the canvas element we want to select
		var ctx = objChart.getContext("2d");
		window.myLine  = new Chart(ctx).Pie(data, {animateScale: true});
	}

	function removeData() {
		console.log('PLOT-REMOVE-DATA')
		config.data.labels.pop();
		data_length = config.data.labels.length;
		for (ix = 0; ix < data_length; ix++) {
			config.data.datasets.forEach((dataset) => {
			dataset.data.pop();
			});
		}
		
		window.myLine.update();
	}

	window.onload = function() {
		var ctx = document.getElementById('canvas').getContext('2d');
		window.myLine = new Chart(ctx, config);
	};

		function addData() {
		if (config.data.datasets.length > 0) {
			data_points = get_data();
			config.data.labels.push(data_points[0]);
			let i = 1;
			
			config.data.datasets.forEach(function(dataset) {

					dataset.data.push(get_data()[i]);
					i++
			});

			window.myLine.update();
		}
	}

		

		
    

	</script>
  
  
 
</body>

</html>